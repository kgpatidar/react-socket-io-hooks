{"version":3,"file":"SocketProvider.js","sources":["../src/SocketProvider.js"],"sourcesContent":["import React, { useState, useReducer, useEffect, useContext } from 'react';\r\nimport io from 'socket.io-client';\r\n\r\nconst SocketContext = React.createContext(null);\r\n\r\nexport const SocketProvider = ({ uri, children, reducer, socketOpts = {}, initialState = {} }) => {\r\n  const [socket, setSocket] = useState({});\r\n  const [state, dispatch] = useReducer(reducer, initialState);\r\n\r\n  useEffect(() => {\r\n    const newSocket = io.connect(uri, socketOpts);\r\n    const emit = newSocket.io.emit.bind(newSocket.io);\r\n    newSocket.io.emit = function (...args) {\r\n      const [eventType, event] = args;\r\n      if (eventType === 'packet') {\r\n        const { data = [] } = event;\r\n        const [eventName, payload] = data;\r\n        const action = { type: eventName, payload };\r\n        dispatch(action);\r\n      }\r\n\r\n      return emit(...args);\r\n    };\r\n\r\n    setSocket(newSocket);\r\n\r\n    return () => {\r\n      setSocket(null);\r\n      return newSocket.disconnect();\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <SocketContext.Provider value={{ socket, state, dispatch }}>\r\n      {children}\r\n    </SocketContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useSocket = () => {\r\n  const { socket } = useContext(SocketContext);\r\n  return socket;\r\n};\r\n\r\nexport const useSocketState = () => {\r\n  const { state } = useContext(SocketContext);\r\n  return state;\r\n};\r\n\r\nexport const useSocketSelector = selector => {\r\n  const state = useSocketState();\r\n  return selector(state);\r\n}\r\n\r\nexport const useEmit = () => {\r\n  const socket = useSocket();\r\n  return socket.emit;\r\n}\r\n\r\nexport const useEmitEvent = eventName => {\r\n  const socket = useSocket();\r\n  return data => socket.emit(eventName, data);\r\n};\r\n\r\nexport const useSocketDispatch = () => {\r\n  const { dispatch } = useContext(SocketContext);\r\n  return dispatch;\r\n}\r\n"],"names":["SocketContext","React","createContext","SocketProvider","uri","children","reducer","socketOpts","initialState","useState","socket","setSocket","useReducer","state","dispatch","useEffect","newSocket","io","connect","emit","bind","args","eventType","event","data","eventName","payload","action","type","disconnect","useSocket","useContext","useSocketState","useSocketSelector","selector","useEmit","useEmitEvent","useSocketDispatch"],"mappings":"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"}